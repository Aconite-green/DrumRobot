#include <stdio.h>
#include "../include/CanService.hpp"
#include "../include/CanSocketUtils.hpp"
#include "../include/CommandParser.hpp"
#include "../include/ErrorHandle.hpp"
#include "../include/Motor.hpp"
#include "../include/MotorInterface.hpp"

int main()
{

    CanSocketUtils canSocket;
    TMotor tMotor(1, "AK10_9", "Waist");
    CanService canService;

    canSocket.list_and_activate_available_can_ports();
    int can0 = canSocket.create_socket("can0");
    
    canService.checkMotor(tMotor, tMotor.id, can0);
    canService.enterControlMode(tMotor, tMotor.id, can0);
    
    TMotorCommandParser tParser;
    struct can_frame frame;
    
    //To 90 degree
    tParser.parseSendCommand(tMotor, &frame, tMotor.id, 8, 1.57, 0, 8, 1, 0);
    canSocket.send_frame_and_receive_reply(can0, &frame);

    //To zero
    tParser.parseSendCommand(tMotor, &frame, tMotor.id, 8, 0, 0, 8, 1, 0);
    canSocket.send_frame_and_receive_reply(can0, &frame);

    //Stop
    tParser.parseSendCommand(tMotor, &frame, tMotor.id, 8, 0, 0, 0, 0, 0);
    canSocket.send_frame_and_receive_reply(can0, &frame);
    canService.Exit(tMotor, tMotor.id, can0);






}
